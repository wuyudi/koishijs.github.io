<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>用户信息管理 | Koishi</title>
    <meta name="description" content="">
    <link rel="icon" href="/koishi.png">
  <meta name="theme-color" content="#5546a3">
    
    <link rel="preload" href="/assets/css/0.styles.67004ee5.css" as="style"><link rel="preload" href="/assets/js/app.3f171bfd.js" as="script"><link rel="preload" href="/assets/js/2.3565e134.js" as="script"><link rel="preload" href="/assets/js/7.7ead5f91.js" as="script"><link rel="preload" href="/assets/js/42.ba75fafa.js" as="script"><link rel="preload" href="/assets/js/6.b31803c1.js" as="script"><link rel="preload" href="/assets/js/5.eca008f9.js" as="script"><link rel="prefetch" href="/assets/js/10.6ba8c7c3.js"><link rel="prefetch" href="/assets/js/11.0361f298.js"><link rel="prefetch" href="/assets/js/12.6feef351.js"><link rel="prefetch" href="/assets/js/13.b03b21a5.js"><link rel="prefetch" href="/assets/js/14.7408e8c9.js"><link rel="prefetch" href="/assets/js/15.e425130e.js"><link rel="prefetch" href="/assets/js/16.bd95b0a3.js"><link rel="prefetch" href="/assets/js/17.65321faf.js"><link rel="prefetch" href="/assets/js/18.d4a026f6.js"><link rel="prefetch" href="/assets/js/19.b003494e.js"><link rel="prefetch" href="/assets/js/20.6c2e7043.js"><link rel="prefetch" href="/assets/js/21.b60b723a.js"><link rel="prefetch" href="/assets/js/22.2a3430f3.js"><link rel="prefetch" href="/assets/js/23.6940fd73.js"><link rel="prefetch" href="/assets/js/24.7fe53199.js"><link rel="prefetch" href="/assets/js/25.ebf135f0.js"><link rel="prefetch" href="/assets/js/26.be672138.js"><link rel="prefetch" href="/assets/js/27.e20002b3.js"><link rel="prefetch" href="/assets/js/28.69ca12b5.js"><link rel="prefetch" href="/assets/js/29.ca63b0d7.js"><link rel="prefetch" href="/assets/js/3.bed41596.js"><link rel="prefetch" href="/assets/js/30.5695b9a5.js"><link rel="prefetch" href="/assets/js/31.f444d79e.js"><link rel="prefetch" href="/assets/js/32.533ce854.js"><link rel="prefetch" href="/assets/js/33.ff4207d6.js"><link rel="prefetch" href="/assets/js/34.986f75fa.js"><link rel="prefetch" href="/assets/js/35.e3da5f3e.js"><link rel="prefetch" href="/assets/js/36.bae8843f.js"><link rel="prefetch" href="/assets/js/37.ef24995f.js"><link rel="prefetch" href="/assets/js/38.f4d52f32.js"><link rel="prefetch" href="/assets/js/39.8943d2cb.js"><link rel="prefetch" href="/assets/js/4.4199422d.js"><link rel="prefetch" href="/assets/js/40.f49a6865.js"><link rel="prefetch" href="/assets/js/41.70a7cd69.js"><link rel="prefetch" href="/assets/js/43.d39a9a23.js"><link rel="prefetch" href="/assets/js/44.5b7b25c8.js"><link rel="prefetch" href="/assets/js/45.6803e6ce.js"><link rel="prefetch" href="/assets/js/46.df0d977d.js"><link rel="prefetch" href="/assets/js/47.85e8efcb.js"><link rel="prefetch" href="/assets/js/48.8f0535ba.js"><link rel="prefetch" href="/assets/js/49.25d25bcb.js"><link rel="prefetch" href="/assets/js/50.91c50898.js"><link rel="prefetch" href="/assets/js/51.fb8e2d27.js"><link rel="prefetch" href="/assets/js/52.553e26b3.js"><link rel="prefetch" href="/assets/js/53.cdfa1d8b.js"><link rel="prefetch" href="/assets/js/54.10c7ce33.js"><link rel="prefetch" href="/assets/js/55.8cf064a4.js"><link rel="prefetch" href="/assets/js/56.37f13474.js"><link rel="prefetch" href="/assets/js/57.40b1896f.js"><link rel="prefetch" href="/assets/js/58.6a993147.js"><link rel="prefetch" href="/assets/js/8.b72d0443.js"><link rel="prefetch" href="/assets/js/9.64e1463f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.67004ee5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/koishi.png" alt="Koishi" class="logo"> <span class="site-name can-hide">Koishi</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/guide/getting-started.html" class="nav-link">指南</a></div><div class="nav-item"><a href="/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/plugins/" class="nav-link router-link-active">官方插件</a></div><div class="nav-item"><a href="https://github.com/koishijs/koishi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/guide/getting-started.html" class="nav-link">指南</a></div><div class="nav-item"><a href="/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/plugins/" class="nav-link router-link-active">官方插件</a></div><div class="nav-item"><a href="https://github.com/koishijs/koishi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/plugins/" class="sidebar-link">总览</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>常用功能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/plugins/common/overview.html" class="sidebar-link">总览</a></li><li><a href="/plugins/common/help.html" class="sidebar-link">编写和查看帮助</a></li><li><a href="/plugins/common/message.html" class="sidebar-link">消息的发送</a></li><li><a href="/plugins/common/reply.html" class="sidebar-link">消息的响应</a></li><li><a href="/plugins/common/handler.html" class="sidebar-link">处理请求</a></li><li><a href="/plugins/common/information.html" class="active sidebar-link">用户信息管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugins/common/information.html#查看用户信息" class="sidebar-link">查看用户信息</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugins/common/information.html#扩展要显示的信息" class="sidebar-link">扩展要显示的信息</a></li><li class="sidebar-sub-header"><a href="/plugins/common/information.html#显式获取用户名" class="sidebar-link">显式获取用户名</a></li></ul></li><li class="sidebar-sub-header"><a href="/plugins/common/information.html#修改用户数据" class="sidebar-link">修改用户数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugins/common/information.html#修改用户和群数据" class="sidebar-link">修改用户和群数据</a></li><li class="sidebar-sub-header"><a href="/plugins/common/information.html#修改群数据" class="sidebar-link">修改群数据</a></li><li class="sidebar-sub-header"><a href="/plugins/common/information.html#添加可用操作" class="sidebar-link">添加可用操作</a></li></ul></li><li class="sidebar-sub-header"><a href="/plugins/common/information.html#初始化权限等级" class="sidebar-link">初始化权限等级</a></li></ul></li><li><a href="/plugins/common/process.html" class="sidebar-link">进程控制</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他核心插件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/plugins/schedule.html" class="sidebar-link">添加计划任务 (schedule)</a></li><li><a href="/plugins/teach.html" class="sidebar-link">教学系统 (teach)</a></li><li><a href="/plugins/recorder.html" class="sidebar-link">存储聊天记录 (recorder)</a></li><li><a href="/plugins/nlp.html" class="sidebar-link">自然语言处理 (NLP)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他官方插件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/plugins/other/chess.html" class="sidebar-link">下棋 (chess)</a></li><li><a href="/plugins/other/image-search.html" class="sidebar-link">搜图 (image-search)</a></li><li><a href="/plugins/other/status.html" class="sidebar-link">查看运行状态 (status)</a></li><li><a href="/plugins/other/github-webhook.html" class="sidebar-link">接入 GitHub Webhook</a></li><li><a href="/plugins/other/gitlab-webhook.html" class="sidebar-link">接入 GitLab Webhook</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="用户信息管理"><a href="#用户信息管理" class="header-anchor">#</a> 用户信息管理</h1> <h2 id="查看用户信息"><a href="#查看用户信息" class="header-anchor">#</a> 查看用户信息</h2> <p>info 指令可以用于查看用户的信息：</p> <div class="code-container" data-v-156a57d4><div class="controls" data-v-156a57d4><svg xmlns="http://www.w3.org/2000/svg" width="52" height="12" viewBox="0 0 52 12" data-v-156a57d4><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5" data-v-156a57d4></circle> <circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5" data-v-156a57d4></circle> <circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5" data-v-156a57d4></circle></svg> <div class="title" data-v-156a57d4></div></div> <pre class="shiki" style="background-color:#272822;" data-v-156a57d4><code data-v-156a57d4><span style="color:#F8F8F2;" data-v-156a57d4>info                    </span><span style="color:#75715E;" data-v-156a57d4># 查看自己的用户信息</span>
<span style="color:#F8F8F2;" data-v-156a57d4>info qq                 </span><span style="color:#75715E;" data-v-156a57d4># 查看其他用户的信息</span></code></pre></div><p>你将得到这样的结果：</p> <div class="code-container" data-v-156a57d4><div class="controls" data-v-156a57d4><svg xmlns="http://www.w3.org/2000/svg" width="52" height="12" viewBox="0 0 52 12" data-v-156a57d4><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5" data-v-156a57d4></circle> <circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5" data-v-156a57d4></circle> <circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5" data-v-156a57d4></circle></svg> <div class="title" data-v-156a57d4></div></div> <pre data-v-156a57d4><code data-v-156a57d4>xxx，您的权限为 3 级。
123456789 的权限为 2 级。
</code></pre></div><p>与许多指令不同的是，info 指令查看个人信息所需的最低权限等级为 0 级，而查看他人信息默认需要 3 级权限。</p> <h3 id="扩展要显示的信息"><a href="#扩展要显示的信息" class="header-anchor">#</a> 扩展要显示的信息</h3> <p>我们也可以为这个指令添加其他输出结果。假设现在我们向用户数据添加了 money 字段表示用户余额，那么我们可以这样写：</p> <div class="code-container" data-v-156a57d4><div class="controls" data-v-156a57d4><svg xmlns="http://www.w3.org/2000/svg" width="52" height="12" viewBox="0 0 52 12" data-v-156a57d4><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5" data-v-156a57d4></circle> <circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5" data-v-156a57d4></circle> <circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5" data-v-156a57d4></circle></svg> <div class="title" data-v-156a57d4></div></div> <pre class="shiki" style="background-color:#272822;" data-v-156a57d4><code data-v-156a57d4><span style="color:#66D9EF;" data-v-156a57d4>const</span><span style="color:#F8F8F2;" data-v-156a57d4> { commonPlugin } </span><span style="color:#F92672;" data-v-156a57d4>=</span><span style="color:#F8F8F2;" data-v-156a57d4> </span><span style="color:#66D9EF;" data-v-156a57d4>require</span><span style="color:#F8F8F2;" data-v-156a57d4>(</span><span style="color:#E6DB74;" data-v-156a57d4>'koishi'</span><span style="color:#F8F8F2;" data-v-156a57d4>)</span>

<span style="color:#75715E;" data-v-156a57d4>// registerUserInfo 传入两个参数</span>
<span style="color:#75715E;" data-v-156a57d4>// 第一个参数是回调函数，传入用户数据，返回输出结果</span>
<span style="color:#75715E;" data-v-156a57d4>// 第二个参数是需要用到的字段列表（可选）</span>
<span style="color:#F8F8F2;" data-v-156a57d4>commonPlugin.</span><span style="color:#A6E22E;" data-v-156a57d4>registerUserInfo</span><span style="color:#F8F8F2;" data-v-156a57d4>(</span><span style="color:#FD971F;" data-v-156a57d4>user</span><span style="color:#F8F8F2;" data-v-156a57d4> </span><span style="color:#66D9EF;" data-v-156a57d4>=&gt;</span><span style="color:#F8F8F2;" data-v-156a57d4> </span><span style="color:#E6DB74;" data-v-156a57d4>`余额：${user.money}￥`</span><span style="color:#F8F8F2;" data-v-156a57d4>, [</span><span style="color:#E6DB74;" data-v-156a57d4>'money'</span><span style="color:#F8F8F2;" data-v-156a57d4>])</span></code></pre></div><p>再次运行程序，你会发现输出变成了：</p> <div class="code-container" data-v-156a57d4><div class="controls" data-v-156a57d4><svg xmlns="http://www.w3.org/2000/svg" width="52" height="12" viewBox="0 0 52 12" data-v-156a57d4><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5" data-v-156a57d4></circle> <circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5" data-v-156a57d4></circle> <circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5" data-v-156a57d4></circle></svg> <div class="title" data-v-156a57d4></div></div> <pre data-v-156a57d4><code data-v-156a57d4>xxx，您的权限为 3 级。
余额：100￥
</code></pre></div><h3 id="显式获取用户名"><a href="#显式获取用户名" class="header-anchor">#</a> 显式获取用户名 <span class="badge tip" style="vertical-align:top;" data-v-c13ee5b0>1.5.0+</span></h3> <p>默认情况下，info 指令会依次尝试使用 <code>meta.sender.card</code>, <code>meta.sender.nickname</code> 作为你的称呼。换言之，你在不同的上下文中可能得到不同的称呼，同时查看他人信息时将只能使用 QQ 号来称呼。如果想要显示设置获取用户名的方法，你可以使用 <code>getUserName</code> 配置项：</p> <div class="code-container show-title" data-v-156a57d4><div class="controls" data-v-156a57d4><svg xmlns="http://www.w3.org/2000/svg" width="52" height="12" viewBox="0 0 52 12" data-v-156a57d4><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5" data-v-156a57d4></circle> <circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5" data-v-156a57d4></circle> <circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5" data-v-156a57d4></circle></svg> <div class="title" data-v-156a57d4>koishi.config.js</div></div> <pre class="shiki" style="background-color:#272822;" data-v-156a57d4><code data-v-156a57d4><span style="color:#66D9EF;" data-v-156a57d4>module</span><span style="color:#F8F8F2;" data-v-156a57d4>.</span><span style="color:#66D9EF;" data-v-156a57d4>exports</span><span style="color:#F8F8F2;" data-v-156a57d4> </span><span style="color:#F92672;" data-v-156a57d4>=</span><span style="color:#F8F8F2;" data-v-156a57d4> {</span>
<span style="color:#F8F8F2;" data-v-156a57d4>  plugins: [[</span><span style="color:#E6DB74;" data-v-156a57d4>'common'</span><span style="color:#F8F8F2;" data-v-156a57d4>, {</span>
<span style="color:#F8F8F2;" data-v-156a57d4>    </span><span style="color:#A6E22E;" data-v-156a57d4>getUserName</span><span style="color:#F8F8F2;" data-v-156a57d4> (</span><span style="color:#FD971F;" data-v-156a57d4>user</span><span style="color:#F8F8F2;" data-v-156a57d4>, </span><span style="color:#FD971F;" data-v-156a57d4>meta</span><span style="color:#F8F8F2;" data-v-156a57d4>) {</span>
<span style="color:#F8F8F2;" data-v-156a57d4>      </span><span style="color:#75715E;" data-v-156a57d4>// 这里展示的正是默认的行为</span>
<span style="color:#F8F8F2;" data-v-156a57d4>      </span><span style="color:#75715E;" data-v-156a57d4>// 这个函数返回的值将作为该用户的称呼</span>
<span style="color:#F8F8F2;" data-v-156a57d4>      </span><span style="color:#75715E;" data-v-156a57d4>// 如果没有任何输出则会使用 QQ 号</span>
<span style="color:#F8F8F2;" data-v-156a57d4>      </span><span style="color:#F92672;" data-v-156a57d4>if</span><span style="color:#F8F8F2;" data-v-156a57d4> (meta.userId </span><span style="color:#F92672;" data-v-156a57d4>===</span><span style="color:#F8F8F2;" data-v-156a57d4> user.id </span><span style="color:#F92672;" data-v-156a57d4>&amp;&amp;</span><span style="color:#F8F8F2;" data-v-156a57d4> meta.sender) {</span>
<span style="color:#F8F8F2;" data-v-156a57d4>        </span><span style="color:#F92672;" data-v-156a57d4>return</span><span style="color:#F8F8F2;" data-v-156a57d4> meta.sender.card </span><span style="color:#F92672;" data-v-156a57d4>||</span><span style="color:#F8F8F2;" data-v-156a57d4> meta.sender.nickname</span>
<span style="color:#F8F8F2;" data-v-156a57d4>      }</span>
<span style="color:#F8F8F2;" data-v-156a57d4>    },</span>
<span style="color:#F8F8F2;" data-v-156a57d4>  }]],</span>
<span style="color:#F8F8F2;" data-v-156a57d4>}</span></code></pre></div><h2 id="修改用户数据"><a href="#修改用户数据" class="header-anchor">#</a> 修改用户数据</h2> <p>admin 指令可以直接修改数据库中的数据：</p> <div class="code-container" data-v-156a57d4><div class="controls" data-v-156a57d4><svg xmlns="http://www.w3.org/2000/svg" width="52" height="12" viewBox="0 0 52 12" data-v-156a57d4><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5" data-v-156a57d4></circle> <circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5" data-v-156a57d4></circle> <circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5" data-v-156a57d4></circle></svg> <div class="title" data-v-156a57d4></div></div> <pre class="shiki" style="background-color:#272822;" data-v-156a57d4><code data-v-156a57d4><span style="color:#F8F8F2;" data-v-156a57d4>admin show-usage teach          </span><span style="color:#75715E;" data-v-156a57d4># 输出你今天 teach 指令的调用次数</span>
<span style="color:#F8F8F2;" data-v-156a57d4>admin -u 123 set-auth 2         </span><span style="color:#75715E;" data-v-156a57d4># 将用户 123 的权限更改为 2 级</span>
<span style="color:#F8F8F2;" data-v-156a57d4>admin -g                        </span><span style="color:#75715E;" data-v-156a57d4># 输出可用于群的操作列表</span>
<span style="color:#F8F8F2;" data-v-156a57d4>admin -g 456 set-flag no-emit   </span><span style="color:#75715E;" data-v-156a57d4># 设置群 456 不主动发送任何信息</span></code></pre></div><p>一般的调用格式为 <code>admin [target] [action &lt;...args&gt;]</code>，其中：</p> <ul><li><code>target</code> 用于指定针对目标，<code>-u &lt;id&gt;</code> 表示要修改的是用户，<code>-g &lt;id&gt;</code> 表示要修改的是群，<code>-G</code> 表示要修改的是本群，缺省表示要修改的是自己</li> <li><code>action</code> 用于指定要做的操作，对用户和群是不同的；缺省则会输出可用的操作列表</li> <li><code>args</code> 是执行操作所需的参数，由 <code>action</code> 决定</li></ul> <p>调用 admin 指令所需的最低权限为 4 级，同时如果目标为用户，则目标用户的等级必须低于调用者。</p> <h3 id="修改用户和群数据"><a href="#修改用户和群数据" class="header-anchor">#</a> 修改用户和群数据</h3> <p>下面展示了所有内置的用于修改用户数据的操作：</p> <h4 id="set-auth"><a href="#set-auth" class="header-anchor">#</a> set-auth</h4> <ul><li>语法：<code>admin -u &lt;id&gt; set-auth &lt;auth&gt;</code></li> <li>功能：修改用户权限，其中 auth 必须小于调用者自身的权限等级</li></ul> <h4 id="set-flag"><a href="#set-flag" class="header-anchor">#</a> set-flag</h4> <ul><li>语法：<code>admin -u &lt;id&gt; set-flag &lt;...flags&gt;</code></li> <li>功能：设置用户的状态标签，所有写在 flags 中的状态标签会被设置为真；如果缺省则会显示可用的状态标签列表</li></ul> <h4 id="unset-flag"><a href="#unset-flag" class="header-anchor">#</a> unset-flag</h4> <ul><li>语法：<code>admin -u &lt;id&gt; unset-flag &lt;...flags&gt;</code></li> <li>功能：取消用户的状态标签，所有写在 flags 中的状态标签会被设置为假；如果缺省则会显示可用的状态标签列表</li></ul> <h4 id="show-usage"><a href="#show-usage" class="header-anchor">#</a> show-usage</h4> <ul><li>语法：<code>admin -u &lt;id&gt; show-usage &lt;...commands&gt;</code></li> <li>功能：查看用户的 commands 指令调用情况；缺省则会显示全部以使用指令的调用情况</li></ul> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果指令本身不带有 <code>maxUsage</code>, <code>minInterval</code> 等配置，则不会对调用次数计数，因此也无法查看这类指令的调用情况。</p></div> <h4 id="clear-usage"><a href="#clear-usage" class="header-anchor">#</a> clear-usage</h4> <ul><li>语法：<code>admin -u &lt;id&gt; clear-usage &lt;...commands&gt;</code></li> <li>功能：清空用户的 commands 指令调用次数；缺省则会清空全部指令的调用次数</li></ul> <h3 id="修改群数据"><a href="#修改群数据" class="header-anchor">#</a> 修改群数据</h3> <p>下面展示了所有内置的用于修改群数据的操作：</p> <h4 id="set-flag-2"><a href="#set-flag-2" class="header-anchor">#</a> set-flag</h4> <ul><li>语法：<code>admin -g &lt;id&gt; set-flag &lt;...flags&gt;</code></li> <li>功能：设置群的状态标签，所有写在 flags 中的状态标签会被设置为真；如果缺省则会显示可用的状态标签列表</li></ul> <h4 id="unset-flag-2"><a href="#unset-flag-2" class="header-anchor">#</a> unset-flag</h4> <ul><li>语法：<code>admin -g &lt;id&gt; unset-flag &lt;...flags&gt;</code></li> <li>功能：取消群的状态标签，所有写在 flags 中的状态标签会被设置为假；如果缺省则会显示可用的状态标签列表</li></ul> <h3 id="添加可用操作"><a href="#添加可用操作" class="header-anchor">#</a> 添加可用操作</h3> <p>我们也可以为这个指令添加可用的操作。还是以上面的 money 为例，我们可以添加一个 set-money 操作，就像这样：</p> <div class="code-container" data-v-156a57d4><div class="controls" data-v-156a57d4><svg xmlns="http://www.w3.org/2000/svg" width="52" height="12" viewBox="0 0 52 12" data-v-156a57d4><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5" data-v-156a57d4></circle> <circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5" data-v-156a57d4></circle> <circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5" data-v-156a57d4></circle></svg> <div class="title" data-v-156a57d4></div></div> <pre class="shiki" style="background-color:#272822;" data-v-156a57d4><code data-v-156a57d4><span style="color:#66D9EF;" data-v-156a57d4>const</span><span style="color:#F8F8F2;" data-v-156a57d4> { commonPlugin } </span><span style="color:#F92672;" data-v-156a57d4>=</span><span style="color:#F8F8F2;" data-v-156a57d4> </span><span style="color:#66D9EF;" data-v-156a57d4>require</span><span style="color:#F8F8F2;" data-v-156a57d4>(</span><span style="color:#E6DB74;" data-v-156a57d4>'koishi'</span><span style="color:#F8F8F2;" data-v-156a57d4>)</span>

<span style="color:#F8F8F2;" data-v-156a57d4>commonPlugin.</span><span style="color:#A6E22E;" data-v-156a57d4>registerUserAction</span><span style="color:#F8F8F2;" data-v-156a57d4>(</span><span style="color:#E6DB74;" data-v-156a57d4>'set-money'</span><span style="color:#F8F8F2;" data-v-156a57d4>, (</span><span style="color:#FD971F;" data-v-156a57d4>meta</span><span style="color:#F8F8F2;" data-v-156a57d4>, </span><span style="color:#FD971F;" data-v-156a57d4>user</span><span style="color:#F8F8F2;" data-v-156a57d4>, </span><span style="color:#FD971F;" data-v-156a57d4>value</span><span style="color:#F8F8F2;" data-v-156a57d4>) </span><span style="color:#66D9EF;" data-v-156a57d4>=&gt;</span><span style="color:#F8F8F2;" data-v-156a57d4> {</span>
<span style="color:#F8F8F2;" data-v-156a57d4>  user.money </span><span style="color:#F92672;" data-v-156a57d4>=</span><span style="color:#F8F8F2;" data-v-156a57d4> </span><span style="color:#F92672;" data-v-156a57d4>+</span><span style="color:#F8F8F2;" data-v-156a57d4>value   </span><span style="color:#75715E;" data-v-156a57d4>// 注意这里的 value 原来是字符串</span>
<span style="color:#F8F8F2;" data-v-156a57d4>  user.</span><span style="color:#A6E22E;" data-v-156a57d4>_update</span><span style="color:#F8F8F2;" data-v-156a57d4>()        </span><span style="color:#75715E;" data-v-156a57d4>// 如果目标不是自己，则数据不会自动更新，因此这里手动更新了数据</span>
<span style="color:#F8F8F2;" data-v-156a57d4>  </span><span style="color:#F92672;" data-v-156a57d4>return</span><span style="color:#F8F8F2;" data-v-156a57d4> meta.</span><span style="color:#A6E22E;" data-v-156a57d4>$send</span><span style="color:#F8F8F2;" data-v-156a57d4>(</span><span style="color:#E6DB74;" data-v-156a57d4>'余额已更新！'</span><span style="color:#F8F8F2;" data-v-156a57d4>)</span>
<span style="color:#F8F8F2;" data-v-156a57d4>}, [</span><span style="color:#E6DB74;" data-v-156a57d4>'money'</span><span style="color:#F8F8F2;" data-v-156a57d4>])</span></code></pre></div><h2 id="初始化权限等级"><a href="#初始化权限等级" class="header-anchor">#</a> 初始化权限等级</h2> <p>尽管机器人的管理者可以利用 admin 指令方便地在运行时控制他人的权限等级和其他数据，但是当机器人刚刚加群的时候想要批量给群友权限仍然是一件麻烦的事情。因此，koishi-plugin-common 提供了另一项技术用于在机器人初始化时批量初始化权限等级。</p> <div class="code-container show-title" data-v-156a57d4><div class="controls" data-v-156a57d4><svg xmlns="http://www.w3.org/2000/svg" width="52" height="12" viewBox="0 0 52 12" data-v-156a57d4><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5" data-v-156a57d4></circle> <circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5" data-v-156a57d4></circle> <circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5" data-v-156a57d4></circle></svg> <div class="title" data-v-156a57d4>koishi.config.js</div></div> <pre class="shiki" style="background-color:#272822;" data-v-156a57d4><code data-v-156a57d4><span style="color:#66D9EF;" data-v-156a57d4>module</span><span style="color:#F8F8F2;" data-v-156a57d4>.</span><span style="color:#66D9EF;" data-v-156a57d4>exports</span><span style="color:#F8F8F2;" data-v-156a57d4> </span><span style="color:#F92672;" data-v-156a57d4>=</span><span style="color:#F8F8F2;" data-v-156a57d4> {</span>
<span style="color:#F8F8F2;" data-v-156a57d4>  plugins: [[</span><span style="color:#E6DB74;" data-v-156a57d4>'common'</span><span style="color:#F8F8F2;" data-v-156a57d4>, {</span>
<span style="color:#F8F8F2;" data-v-156a57d4>    authorizeUser: {</span>
<span style="color:#F8F8F2;" data-v-156a57d4>      </span><span style="color:#75715E;" data-v-156a57d4>// 设置玩家最低权限</span>
<span style="color:#F8F8F2;" data-v-156a57d4>      123456789: 3,</span>
<span style="color:#F8F8F2;" data-v-156a57d4>    },</span>
<span style="color:#F8F8F2;" data-v-156a57d4>    authorizeGroup: {</span>
<span style="color:#F8F8F2;" data-v-156a57d4>      </span><span style="color:#75715E;" data-v-156a57d4>// 设置全群玩家最低权限为 2 级</span>
<span style="color:#F8F8F2;" data-v-156a57d4>      111222333: 2,</span>
<span style="color:#F8F8F2;" data-v-156a57d4>      </span><span style="color:#75715E;" data-v-156a57d4>// 分别设置每类成员的最低权限</span>
<span style="color:#F8F8F2;" data-v-156a57d4>      777888999: { member: </span><span style="color:#AE81FF;" data-v-156a57d4>1</span><span style="color:#F8F8F2;" data-v-156a57d4>, admin: </span><span style="color:#AE81FF;" data-v-156a57d4>2</span><span style="color:#F8F8F2;" data-v-156a57d4>, owner: </span><span style="color:#AE81FF;" data-v-156a57d4>3</span><span style="color:#F8F8F2;" data-v-156a57d4> },</span>
<span style="color:#F8F8F2;" data-v-156a57d4>    },</span>
<span style="color:#F8F8F2;" data-v-156a57d4>  }]],</span>
<span style="color:#F8F8F2;" data-v-156a57d4>}</span></code></pre></div><p>启动你的机器人，插件会在启动后一段时间内完成对上述成员的权限等级初始化。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>这个插件的功能是设置最低权限等级，因此如果出现账号已经存在，或者多项配置冲突的情况（例如加了多个群），插件会自动选择<strong>最高的权限值</strong>进行设置。</p></div> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>由于 CoolQ 的机制问题，机器人刚加某个群时可能无法获取成员列表，从而导致插件无法运行。遇到这种情况一般等待 1-2 天即可恢复正常。</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/koishijs/koishijs.github.io/edit/docs/plugins/common/information.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">1/20/2020, 5:07:42 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/plugins/common/handler.html" class="prev">处理请求</a></span> <span class="next"><a href="/plugins/common/process.html">进程控制</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.3f171bfd.js" defer></script><script src="/assets/js/2.3565e134.js" defer></script><script src="/assets/js/7.7ead5f91.js" defer></script><script src="/assets/js/42.ba75fafa.js" defer></script><script src="/assets/js/6.b31803c1.js" defer></script><script src="/assets/js/5.eca008f9.js" defer></script>
  </body>
</html>
